// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{const e=(e,t=document)=>t.querySelector(e),t=document.querySelector("form"),o=e("#results"),n=e("#platform"),a=e("#format"),s=e("#formatHint"),r=e("#clearBtn"),i={facebook:["Post","Story","Reel"],instagram:["Post","Story","Reel"],twitter:["Post"],linkedin:["Profile","Page"],gmb:["Post"],tiktok:["Video"],ytshorts:["Short"],youtube:["Video"]},l={"facebook:post":"1â€“3 short paragraphs â€¢ 4â€“7 hashtags","facebook:story":"2â€“3 lines â€¢ no hashtags â€¢ link sticker","facebook:reel":"Hook + 1â€“2 lines â€¢ 3â€“5 hashtags","instagram:post":"Hook + 2â€“3 lines â€¢ 5â€“9 hashtags","instagram:story":"Very short â€¢ no hashtag soup â€¢ link sticker","instagram:reel":"Hook + benefit + CTA â€¢ 3â€“7 hashtags","twitter:post":"<280 chars â€¢ â‰¤2 hashtags","linkedin:profile":"3â€“6 lines â€¢ business tone â€¢ â‰¤3 hashtags","linkedin:page":"Brand voice â€¢ â‰¤3 hashtags","gmb:post":"Plain, local keywords â€¢ no hashtags","tiktok:video":"Hook + 2 lines + CTA â€¢ 6â€“10 hashtags","ytshorts:short":"2â€“3 lines â€¢ 3â€“5 hashtags","youtube:video":"Title + description â€¢ no hashtag soup"};function c(){const e=(n?.value||"Facebook").toLowerCase(),t=i[e]||["Post"];a&&(a.innerHTML="",t.forEach((e=>{const t=document.createElement("option");t.textContent=e,a.appendChild(t)}))),u()}function u(){if(!s)return;const e=`${(n?.value||"Facebook").toLowerCase()}:${(a?.value||"Post").toLowerCase()}`;s.textContent=l[e]||""}n?.addEventListener("change",c),a?.addEventListener("change",u),c();const d=e=>e.toString().trim().replace(/\s+/g," ").replace(/(^\w)|([.!?]\s+\w)/g,(e=>e.toUpperCase())),m=e=>/[.!?]$/.test(e.trim())?e.trim():e.trim()+".",h=(e,t)=>e.length<=t?e:e.slice(0,t-1).trim()+"â€¦",p=e=>e[Math.floor(Math.random()*e.length)],g=e=>/(https?:\/\/[^\s)]+)|(www\.[^\s)]+)/i.test(e),f=e=>e.trim().startsWith("#"),y=e=>/^title:/i.test(e.trim()),b=/(https?:\/\/[^\s)]+)|(www\.[^\s)]+)/i,$=/(https?:\/\/[^\s)]+)|(www\.[^\s)]+)/gi;function w(e,t="standard",o=!0,n="default",a="post"){const s=(n||"").toLowerCase(),r=(a||"").toLowerCase();if("gmb"===s||"youtube"===s||"story"===r)return"";let i=(e||"").split(",").map((e=>e.trim())).filter(Boolean);o&&(i=i.map((e=>e.toLowerCase().replace(/[^a-z0-9]+/g,""))),i=[...new Set(i)]);let l=5;return"instagram"===s||"facebook"===s?l="reel"===r?7:"heavy"===t?10:"light"===t?4:7:"twitter"===s?l="heavy"===t?3:2:"linkedin"===s?l="heavy"===t?5:"light"===t?2:3:"tiktok"===s?l="heavy"===t?15:"light"===t?6:10:"ytshorts"===s&&(l="heavy"===t?7:"light"===t?3:5),i=i.slice(0,l).map((e=>e.startsWith("#")?e:`#${e}`)),i.join(" ")}const v=/(?:get|have|be|is|are|was|were|do|make|build|grow|find|fix|help|win|drive|boost|book|buy|claim|start|learn|see|save|earn|bring|keep|write|post|plan|schedule|recap)/i;function k(e){if(f(e)||g(e)||y(e))return e.trim();let t=e.replace(/\s{2,}/g," ").replace(/\.{4,}/g,"â€¦").trim();return t=t.replace(/\b(\w+)\s+\1\b/gi,"$1"),t.length>0&&(t=t[0].toUpperCase()+t.slice(1)),t}function L(e){const t=e.trim();if(!t)return!1;if(f(t)||g(t)||y(t))return!1;const o=t.length<25&&!/[!?]$/.test(t),n=!v.test(t);return o||n}function C(e,t,o,n,a,s){const r=e.result_verbs;if("community"===s){const s=e.pains,i=e.benefits_social,l=e.benefits_time;return t%3==0?{pain:o||`No time to keep your group lively: ${s[0]}.`,benefit:`With ${a}, ${l[t%l.length]}.`,result:`${r[t%r.length]}: ${n||i[(t+1)%i.length]}.`}:t%3==1?{pain:o||`Itâ€™s easy to burn out: ${s[1]}.`,benefit:`We handle the words so you donâ€™t have toâ€”${i[t%i.length]}.`,result:`${r[t%r.length]}: ${n||i[(t+1)%i.length]}.`}:{pain:o||`Keeping momentum is hard: ${s[2]}.`,benefit:`${a} means ${i[t%i.length]}.`,result:`${r[t%r.length]}: ${n||l[(t+1)%l.length]}.`}}if("authority"===s){const s=e.pains,i=e.benefits_status,l=e.benefits_time;return t%3==0?{pain:o||`Credibility slips when content lags: ${s[0]}.`,benefit:`With ${a}, you show up reliably and on-message.`,result:`${r[t%r.length]}: ${n||i[(t+1)%i.length]}.`}:t%3==1?{pain:o||`Consistency is a heavy lift: ${s[1]}.`,benefit:`${a} cuts the lift so your expertise stays front and center.`,result:`${r[t%r.length]}: ${n||l[(t+1)%l.length]}.`}:{pain:o||`The jobâ€™s bigger than it looks: ${s[2]}.`,benefit:`${a} helps you communicate like a trusted voice.`,result:`${r[t%r.length]}: ${n||i[(t+1)%i.length]}.`}}const i=e.pains,l=e.benefits_time,c=e.benefits_social;return t%3==0?{pain:o||`Itâ€™s tough when people canâ€™t find you: ${i[0]}.`,benefit:`With ${a}, you save hours and stay visible.`,result:`${r[t%r.length]}: ${n||"more inquiries without the scramble"}.`}:t%3==1?{pain:o||`Content eats your time: ${i[1]}.`,benefit:`${a} handles the heavy liftingâ€”${l[t%l.length]}.`,result:`${r[t%r.length]}: ${n||c[(t+1)%c.length]}.`}:{pain:o||`Ideas run out mid-week: ${i[2]}.`,benefit:`${a} keeps you shipping, stress-free.`,result:`${r[t%r.length]}: ${n||"consistent posts that sound human"}.`}}const S="cc_onboarding_personas",x="cc_writer_persona_selected",I="cc_mascot_name";function _(){try{return JSON.parse(localStorage.getItem(S)||"[]")}catch{return[]}}function B(){return localStorage.getItem(x)||"brand"}function E(){return localStorage.getItem(I)||""}function M(){const e=_(),t=document.getElementById("writerPersonaGroup"),o=document.getElementById("writerPersona"),n=document.getElementById("mascotNameGroup"),a=document.getElementById("mascotName");if(t&&o)if(!e||e.length<=1)t.style.display="none";else{t.style.display="",o.innerHTML="",e.forEach((e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.label||e.id,o.appendChild(t)})),o.value=B();const s=e.some((e=>"mascot"===e.id)),r=o.value;if(n&&(n.style.display=s&&"mascot"===r?"":"none"),a&&s){const t=e.find((e=>"mascot"===e.id&&e.name))?.name;a.value=t||E()||"",a.addEventListener("input",(()=>{return e=a.value,void localStorage.setItem(I,(e||"").trim());var e}))}o.addEventListener("change",(()=>{var e;e=o.value,localStorage.setItem(x,e),n&&(n.style.display="mascot"===o.value?"":"none")}))}}function P(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function N(){try{return JSON.parse(localStorage.getItem("dcc_usage")||"{}")}catch{return{}}}function H(){const e=P(),t=N();var o;return t[e]=(t[e]||0)+1,o=t,localStorage.setItem("dcc_usage",JSON.stringify(o)),t[e]}function j(){return N()[P()]||0}function T(){return"1"===(e="pro",new URLSearchParams(location.search).get(e))||("1"===localStorage.getItem("dcc_pro")||!!localStorage.getItem("dcc_pro_email"));var e}!function(){if(!localStorage.getItem(S)){const e=[{id:"brand",label:"My Brand (we/us)"}];localStorage.setItem(S,JSON.stringify(e)),localStorage.setItem(x,"brand")}}(),window.CaptionCraft=window.CaptionCraft||{},window.CaptionCraft.saveOnboardingPersonas=function(e){try{if(!Array.isArray(e)||0===e.length)return;localStorage.setItem(S,JSON.stringify(e));const t=localStorage.getItem(x),o=new Set(e.map((e=>e.id)));t&&o.has(t)||localStorage.setItem(x,e[0].id);const n=e.find((e=>"mascot"===e.id&&e.name));n&&n.name&&localStorage.setItem(I,n.name),M()}catch(e){}},M();const A=e("#upgradeModal");function O(){A&&(A.style.display="none")}function W(){T();const t=T()?0:j(),o=e("#usageCounter");o&&(o.textContent=T()?"Pro: unlimited generations":`Free: ${Math.max(0,3-t)} of 3 left today`)}const D=["Book now","Grab your spot","Message us to claim","Call today","Learn more","Get a free quote","Schedule today"];function q(e){const t=[...D],o=[];for(e&&o.push(e);o.length<3&&t.length;){const e=Math.floor(Math.random()*t.length);o.push(t.splice(e,1)[0])}return Array.from(new Set(o)).slice(0,3)}window.addEventListener("DOMContentLoaded",(()=>{e("#captionForm");const t=e("#results");e("#upgradeBtn")?.addEventListener("click",(()=>{window.location.href="https://buy.stripe.com/6oUaEY6oTaHBcd6drP0x203"})),e("#alreadyProBtn")?.addEventListener("click",(async()=>{const e=prompt("Enter the email you used to upgrade (temporary local unlock):");e&&/\S+@\S+\.\S+/.test(e)?(localStorage.setItem("dcc_pro_email",e),localStorage.setItem("dcc_pro","1"),O(),W(),alert("Pro unlocked on this browser.")):alert("That email doesnâ€™t look valid.")})),e("#closeModalBtn")?.addEventListener("click",O),window.addEventListener("click",(e=>{e.target===A&&O()})),t?.addEventListener("click",(e=>{const t=e.target.closest("button[data-copy]");t&&(!function(e){const t=document.getElementById(e);t.select(),t.setSelectionRange(0,99999),document.execCommand("copy")}(t.getAttribute("data-copy")),t.textContent="Copied!",setTimeout((()=>t.textContent="Copy"),900))})),W()}));const F={_assemble(e){const{writerLine:t,variantIndex:o,profile:n,voiceMode:a,hook:s,whoNeed:r,offer:i,outcome:l,cta:c,tags:u,details:d,spacing:m,problem:h}=e,p=C(n,o,h,l,i,a);let g=[s?`${s}.`:"",t?`${t}`:"",r,p.benefit,p.result,c].filter(Boolean).join(m?"\n\n":" ");return u?`${g}\n\n${u}`:g},"facebook:post":e=>F._assemble(e),"facebook:story"({writerLine:e,profile:t,voiceMode:o,variantIndex:n,whoNeed:a,offer:s,outcome:r,cta:i}){const l=C(t,n,"",r,s,o);return`${e?e+"\n":""}${a.replace(/[.]+$/,"")}?\n${s}\n${l.result}\n${i}`},"facebook:reel"({writerLine:e,profile:t,voiceMode:o,variantIndex:n,hook:a,offer:s,outcome:r,cta:i,tags:l}){let c=`${a}\n${e?e+"\n":""}${s} â†’ ${C(t,n,"",r,s,o).result.replace(/^.*?:\s*/,"")}\n${i}`;return c=h(c,300),l?`${c}\n${l}`:c},"instagram:post"({writerLine:e,profile:t,voiceMode:o,variantIndex:n,hook:a,whoNeed:s,offer:r,outcome:i,cta:l,tags:c,details:u,problem:d}){const m=C(t,n,d,i,r,o);let p=(u?[a,e,s,`Weâ€™re handling it with ${r}.`,m.result,l]:[a,e,`${r} â†’ ${m.result.replace(/^.*?:\s*/,"")}`,l]).filter(Boolean).join("\n\n");return p=h(p,900),c?`${p}\n\n${c}`:p},"instagram:story"({writerLine:e,whoNeed:t,offer:o,cta:n}){let a=`${e?e+"\n":""}${t.replace(/[.]+$/,"")}?\n${o}\n${n}`;return h(a,220)},"instagram:reel"({writerLine:e,profile:t,voiceMode:o,variantIndex:n,hook:a,offer:s,outcome:r,cta:i,tags:l}){let c=`${a}\n${e?e+"\n":""}${s} â†’ ${C(t,n,"",r,s,o).result.replace(/^.*?:\s*/,"")}\n${i}`;return c=h(c,300),l?`${c}\n${l}`:c},"twitter:post"({writerLine:e,whoNeed:t,offer:o,outcome:n,cta:a,tags:s,profile:r,voiceMode:i,variantIndex:l}){let c=`${e?e+" ":""}${t} ${o} â†’ ${C(r,l,"",n,o,i).result.replace(/^.*?:\s*/,"")}. ${u=a,u.replace(/[.!\s]+$/g,"")}.`;var u;return c=h(c,280),s?`${c} ${s}`:c},"linkedin:profile":e=>F._assemble(e),"linkedin:page":e=>F._assemble(e),"gmb:post"({writerLine:e,whoNeed:t,offer:o,outcome:n,cta:a}){const s=n||"";return[`**${o}**`,"",`${e?e+"\n":""}${t}`,s?`\n${s}`:"",a,"","Call **270-388-3535** or visit **bluedobiedev.com/contact**"].join("\n")},"tiktok:video"({writerLine:e,whoNeed:t,offer:o,profile:n,voiceMode:a,variantIndex:s,outcome:r,cta:i,tags:l}){let c=`${e?e+"\n":""}${t}\n${o}\n${C(n,s,"",r,o,a).result}\n${i}`;return c=h(c,500),l?`${c}\n${l}`:c},"ytshorts:short"({writerLine:e,whoNeed:t,offer:o,profile:n,voiceMode:a,variantIndex:s,outcome:r,cta:i,tags:l}){let c=`${e?e+"\n":""}${t}\n${o} â†’ ${C(n,s,"",r,o,a).result.replace(/^.*?:\s*/,"")}\n${i}`;return c=h(c,300),l?`${c}\n${l}`:c},"youtube:video":({writerLine:e,whoNeed:t,offer:o,outcome:n,cta:a})=>`Title: ${h(`${o}: ${(n||t).replace(/^[A-Z]/,(e=>e.toLowerCase()))}`,100)}\n\nDescription:\n${["ã€ Speaker ã€‘",e||"â€”","","ã€ Who this is for ã€‘",`${t}`,"","ã€ What youâ€™ll learn ã€‘","â€¢ Why this matters",`â€¢ How ${o} solves it`,`â€¢ What changes: ${n||"less stress, better results"}`,"","ã€ Next step ã€‘",`${a}`,"","â€”","Bluedobie Developing â€¢ 270-388-3535 â€¢ bluedobiedev.com/contact"].join("\n")}`};t?.addEventListener("submit",(async t=>{if(t.preventDefault(),!o)return;if(o.innerHTML="",!T()&&j()>=3)return void(A&&(A.style.display="block"));const s=(e("#audience")?.value||"small business owners").trim(),r=(e("#offer")?.value||"our $299 three-page website special").trim(),i=(e("#outcome")?.value||"more qualified leads in your inbox").trim(),l=(e("#problem")?.value||"customers canâ€™t find your business online").trim(),c=(e("#cta")?.value||"Book your consultation this week.").trim(),u=(e("#keywords")?.value||"webdesign, marketing, bluedobiedev").trim(),v=(n?.value||"Facebook").trim().toLowerCase(),C=(a?.value||"Post").trim().toLowerCase(),S=parseFloat(e("#tone")?.value??"0.5"),x=(I=isNaN(S)?.5:S)<.33?{hookLead:["Quick win","Heads up","A small upgrade = a big payoff"],urgency:["Book now","Ready when you are","Letâ€™s get you visible"]}:I<.66?{hookLead:["Small change, big result","Level up your presence","Time to get found"],urgency:["Book this week","Grab a slot in the next 3 days","Letâ€™s start today"]}:{hookLead:["Your next move, now","Stop leaking time and leads","Visibility that pays for itself"],urgency:["Limited availabilityâ€”lock it in","Last call this week","Start now for the fastest impact"]};var I;const M=(e("#captionLength")?.value||"medium").toLowerCase(),P=(e("#hashtagDensity")?.value||"standard").toLowerCase(),N=e("#cleanHashtags")?.checked??!0,O=function(e){let t=(e||"").trim();return t=t.replace(/\s+special$/i," special"),t}(r),D=function(e){let t=(e||"").replace(/\bin your box\b/gi,"in your inbox").trim();return t=d(t),m(t)}(i),R=function(e){let t=(e||"").replace(/\bis\b/gi,"â€™s").replace(/\bour business\b/gi,"your business").trim();return t=t.replace(/^for\s+busy.*?,\s*/i,""),t=d(t),m(t)}(l),J=(e=>{const t=(e||"").match(b);return t?t[0]:null})(c),G=J?function(e,t,o){try{const n=/^https?:\/\//i.test(e)?e:`https://${e}`,a=new URL(n);return[...a.searchParams.keys()].some((e=>e.toLowerCase().startsWith("utm_")))||(a.searchParams.set("utm_source",(t||"").toLowerCase()),a.searchParams.set("utm_medium",(o||"post").toLowerCase()),a.searchParams.set("utm_campaign","captioncraft")),a.toString()}catch{return e}}(J,v,C):null,U=m((c||"").replace($,"").trim()),V=G?`\n${G}`:"",{maxChars:z,details:Q,spacing:Y}=function(e,t,o){const n=(e||"").toLowerCase(),a=(t||"").toLowerCase(),s=(o||"").toLowerCase();return"twitter"===a?{maxChars:280,details:!1,spacing:!1}:"ytshorts"===a?{maxChars:300,details:!1,spacing:!1}:"tiktok"===a?{maxChars:500,details:!1,spacing:!1}:"youtube"===a?{maxChars:1200,details:!0,spacing:!0}:"story"===s?{maxChars:220,details:!1,spacing:!1}:"short"===n?{maxChars:180,details:!1,spacing:!1}:"long"===n?{maxChars:1100,details:!0,spacing:!0}:{maxChars:450,details:!0,spacing:!1}}(M,v,C),K=w(u,P,N,v,C),Z=x.hookLead,X=p(Z),ee=function(e,t){const o=`${(e||"").toLowerCase()} ${(t||"").toLowerCase()}`;return/(fantasy|espn|commish|commissioner|league|sleeper|yahoo)/.test(o)?{persona:"fantasy_commissioners",voice:"casual",emojiBias:["ðŸˆ","ðŸ˜‚","ðŸŽ™ï¸","ðŸ“£"],needs:["save time","keep the league chat active","funny recaps"]}:/(contractor|plumber|hvac|electrician|roof|remodel)/.test(o)?{persona:"contractors",voice:"direct",emojiBias:["ðŸ› ï¸","ðŸ ","ðŸ“","â±ï¸"],needs:["book jobs","look legit locally","save admin time"]}:/(realtor|real estate|broker|agent)/.test(o)?{persona:"realtors",voice:"polished",emojiBias:["ðŸ¡","ðŸ“","ðŸ—ï¸","ðŸ“†"],needs:["book showings","grow referrals","post consistently"]}:/(restaurant|cafe|coffee|food|bakery)/.test(o)?{persona:"food_service",voice:"warm",emojiBias:["ðŸ”","â˜•","ðŸ¥—","ðŸ“¸"],needs:["foot traffic","repeat visits","local visibility"]}:{persona:"general_smallbiz",voice:"friendly",emojiBias:["ðŸ“Œ","ðŸ¤","ðŸ“ˆ","ðŸ§­"],needs:["save time","post consistently","sound human"]}}(s,u),te=function(e,t,o){const n=(e||"").toLowerCase(),a=(t||"").toLowerCase();return/time|busy|no time|save time|faster/.test(n+a)?"save time":/engage|chat|banter|conversation|quiet|silent|crickets/.test(n+a)?"keep the conversation going":/leads|book|sales|call|inbox/.test(n+a)?"get more inquiries":/consistent|presence|on-brand|look/.test(n+a)?"stay consistent without sounding robotic":o.needs[0]||"get results faster"}(R,D,ee),oe=function(e,t,o){const n=(e||"your audience").trim();switch(o.persona){case"fantasy_commissioners":return`${n} need to ${t} (and keep the league chat alive).`;case"contractors":return`${n} need to ${t} and look legit locally.`;case"realtors":return`${n} need to ${t} and show up consistently.`;case"food_service":return`${n} need to ${t} and bring people in the door.`;default:return`${n} need to ${t}.`}}(s,te,ee),ne=function(e,t){const o=document.getElementById("voiceMode")?.value;return o||("fantasy_commissioners"===e.persona?"community":"linkedin"===(t||"").toLowerCase()?"authority":"leadgen")}(ee,v),ae=function(e,t,o){const n=(e+" "+t+" "+o).toLowerCase();return/fantasy|espn|sleeper|yahoo|commissioner|commish|league/.test(n)?{domain:"fantasy",pains:["no time to write weekly recaps","Sunday-night scramble to sound witty","league chat going quiet by mid-season"],benefits_time:["you get your Sunday night back","skip the scrambleâ€”recaps arrive done","automation handles the recap grind"],benefits_social:["your group chat stays loud past Week 6","friends keep the trash talk going","the league actually reads the recaps"],benefits_status:["you look like an MVP commissioner","your league treats you like a pro","everyone thinks you hired a writer"],result_verbs:["Result","Outcome","Bottom line"]}:{domain:"generic",pains:["hard to keep up with posts","content takes too long to write","ideas run out mid-week"],benefits_time:["you get hours back each week","no more blank-page panic","posts are ready when you are"],benefits_social:["your audience actually engages","comments donâ€™t fizzle out","more saves and shares"],benefits_status:["you look consistent and on-brand","you sound like a real person","you ship content without stress"],result_verbs:["Result","Outcome","Bottom line"]}}(s,u,O),se=function(){const e=_(),t=B();return e.some((e=>e.id===t))?t:e[0]?.id||"brand"}(),re=function(e,t){const o=(t||"your audience").toString().trim();return"owner"===e?`As a fellow ${o}, I get it:`:"mascot"===e?`${E()||"your mascot"} here â€” quick reality check:`:"At Bluedobie, we get it."}(se,s),ie=function({offer:e,problem:t,outcome:o,cta:n}){const a=[];return(!e||e.length<2)&&a.push("Offer looks empty/too short."),(!t||t.length<3)&&a.push("Problem looks empty/too short."),(!o||o.length<3)&&a.push("Outcome looks empty/too short."),(!n||n.length<2)&&a.push("CTA looks empty/too short."),a}({offer:O,problem:R,outcome:D,cta:U});if(ie.length){const e=document.createElement("div");e.className="card",e.style.margin="12px 0",e.style.background="#fff7ed",e.style.borderColor="#fdba74",e.innerHTML=`<strong>Heads up:</strong> ${ie.join(" ")} Weâ€™ll auto-fix obvious fragments.`,o.appendChild(e)}let le=function(e,t,o){const n=`${t}:${o}`.toLowerCase(),a=F[n]||F["facebook:post"],s=[];for(let t=0;t<3;t++){const o={...e,variantIndex:t};s.push(a(o)),e.hook=p(e.hookPool)}return s}({hook:X,hookPool:Z,audience:s,problem:R,offer:O,outcome:D,cta:U,tags:K,details:Q,spacing:Y,intent:ee,need:te,whoNeed:oe,profile:ae,voiceMode:ne,writerId:se,writerLine:re},v,C).map((e=>{let t=e;G&&!["gmb","youtube"].includes(v)&&"story"!==C&&(t=t.length+("\n"+G).length<=z?`${t}${V}`:t);let o={out:t,changed:!1};"youtube"!==v&&(o=function(e){const t=e;let o=!1,n=e.split(/\n+/).map(k).filter((e=>e.length));const a=[];for(let e=0;e<n.length;e++){let t=n[e];if(L(t)){const a=n[e+1];!a||f(a)||y(a)||(t=(t+" "+a).replace(/\s{2,}/g," ").trim(),e+=1,o=!0)}f(t)||g(t)||y(t)||/[.!?]$/.test(t)||(t+="."),a.push(t)}const s=a.join("\n");return{out:s,changed:o||s!==t}}(t));const n="youtube"===v?1200:z;return o.out=h(o.out,n),o}));!function(e,t,o,n){const a=(e||"").toLowerCase();if("instagram"===a){const e=[];return n&&e.push(`ðŸ”— ${n}`),o&&e.push(o),e.join("\n")}if("linkedin"===a){const e=[];n&&e.push(`Quick link: ${n}`),e.push("Questions? Drop a comment and Iâ€™ll reply."),e.join("\n")}}(v,0,K,G);const ce=le.map((e=>e.out));!function(t){const o=e("#results");o&&(o.innerHTML="",t.forEach(((e,t)=>{const n=`copy-${Date.now()}-${t}`;o.insertAdjacentHTML("beforeend",`\n      <article class="card">\n        <div class="card-body">\n          <p>${e}</p>\n          <button class="btn" data-copy="${n}" aria-label="Copy caption">Copy</button>\n        </div>\n        <textarea id="${n}" style="position:absolute;left:-9999px;opacity:0;">${e}</textarea>\n      </article>\n    `)})))}(await async function(e,t){if(!T())return e;try{const o={drafts:e.map(((e,t)=>({id:String(t+1),text:e}))),platform:t.platform||"instagram",tone:"number"==typeof t.tone?t.tone:.5,length:(t.length||"medium").toLowerCase(),ctaOptions:q(t.cta),hashtags:w(t.keywords,(t.hashtagDensity||"standard").toLowerCase(),!1!==t.cleanHashtags,t.platform,t.format)},n=await fetch("https://dobiecore-remix.melanie-brown.workers.dev",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error("remix failed");const a=await n.json();return Array.isArray(a)&&a.length?a.map((e=>String(e.text||""))).filter(Boolean):e}catch(t){return console.warn("AI remix unavailable, using local drafts",t),e}}(ce,{platform:v,tone:parseFloat(e("#tone")?.value||"0.5"),length:M,cta:c,keywords:u,hashtagDensity:P,cleanHashtags:N,format:C})),T()||(H(),W())})),r?.addEventListener("click",(()=>{["audience","offer","outcome","problem","cta","keywords"].forEach((e=>{const t=document.getElementById(e);t&&(t.value="")}));const e=document.getElementById("captionLength");e&&(e.value="Medium");const t=document.getElementById("hashtagDensity");t&&(t.value="Standard");const n=document.getElementById("cleanHashtags");n&&(n.checked=!0);const a=document.getElementById("tone");a&&(a.value=.5),o.innerHTML=""}))}));