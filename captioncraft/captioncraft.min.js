// @ts-nocheck
const qs=(e,t=document)=>t.querySelector(e),qsa=(e,t=document)=>Array.from(t.querySelectorAll(e)),pick=e=>e[Math.floor(Math.random()*e.length)];function todayKey(){const e=new Date;return`dcc_usage_${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}function getUsage(){const e=todayKey();return{key:e,n:parseInt(localStorage.getItem(e)||"0",10)}}function incrementUsage(){const{key:e,n:t}=getUsage();localStorage.setItem(e,String(t+1))}function isPro(){return"1"===localStorage.getItem("dcc_pro")||!!localStorage.getItem("dcc_pro_email")}function updateUsageCounter(){const e=qs("#usageCounter");if(e)if(isPro())e.textContent="Pro: unlimited captions";else{const{n:t}=getUsage();e.textContent=`Free today: ${Math.max(0,3-t)} of 3 left`}}function showUpgrade(){const e=qs("#upgradeModal");e&&(e.style.display="block")}function closeModal(){const e=qs("#upgradeModal");e&&(e.style.display="none")}function cleanPunctuation(e=""){return e.replace(/\s{2,}/g," ").replace(/([.!?])\1{1,}/g,"$1").replace(/([.!?])\s*([.!?])/g,"$1 ").replace(/\s+([,.;:!?])/g,"$1").replace(/([,.;:!?])([^\s])/g,"$1 $2").replace(/\s{2,}/g," ").trim()}function humanize(e,t={}){if(!e)return e;let o=e.trim();if(o=o.split(/\n+/).filter(((e,t,o)=>e.trim()!==(o[t-1]||"").trim())).join("\n"),o=o.replace(/\bwe get it[—-]?\s*/gi,(e=>Math.random()<.4?e:"")),o=o.replace(/\bBottom line:\s*Bottom line:\s*/gi,"Bottom line: "),"linkedin"===(t.platform||"").toLowerCase()){const e=o.split("\n");e.length>6&&(o=e.slice(0,6).join("\n"))}return o=cleanPunctuation(o),o.trim()}function cleanTag(e){return e.toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g,"").replace(/^#+/,"")}function buildHashtags(e="",t="standard",o=!0,a="instagram",n="post"){const r=String(a||"").toLowerCase(),s=String(n||"").toLowerCase();if("gmb"===r||"youtube"===r||"story"===s)return"";let i=String(e||"").split(",").map((e=>e.trim())).filter(Boolean);o&&(i=i.map(cleanTag)),i=[...new Set(i)].filter(Boolean);let l=5;return"instagram"===r||"facebook"===r?l="reel"===s?7:"heavy"===t?10:"light"===t?4:7:"twitter"===r?l="heavy"===t?3:2:"linkedin"===r?l="heavy"===t?5:"light"===t?2:3:"tiktok"===r?l="heavy"===t?15:"light"===t?6:10:"ytshorts"===r&&(l="heavy"===t?7:"light"===t?3:5),i.slice(0,l).map((e=>e?`#${e}`:"")).filter(Boolean).join(" ")}function platformStyle(e){switch((e||"").toLowerCase()){case"linkedin":case"twitter":return{emoji:!1,lineBreaks:!0};case"tiktok":return{emoji:!0,lineBreaks:!1};default:return{emoji:!0,lineBreaks:!0}}}function platformKey(e="Instagram",t="Post"){return`${String(e||"").toLowerCase()}:${String(t||"").toLowerCase()}`}function brandLead(e){const t=(e||"").trim();return t?`At ${t}, `:""}const TPL={"facebook:post":makeTemplate,"facebook:story":makeTemplate,"facebook:reel":makeTemplate,"instagram:post":makeTemplate,"instagram:story":makeTemplate,"instagram:reel":makeTemplate,"twitter:post":makeTemplate,"linkedin:post":makeTemplate,"gmb:post":makeTemplate,"tiktok:video":makeTemplate,"ytshorts:short":makeTemplate};function makeTemplate(e){const{company:t,audience:o,problem:a,outcome:n,offer:r,cta:s,platform:i,tone:l,length:c,keywords:m,format:u,voiceMode:d}=e,p=platformStyle(i),g=brandLead(t),f=(o||"busy owners").replace(/^\w/,(e=>e.toUpperCase())),y=[`${g}we know the hardest part is showing up consistently.`,`${g}you’re juggling real work—marketing shouldn’t burn the day.`,`${g}consistency beats “perfect.” Tools should save time, not steal it.`],h=r?`We built ${r} for real-world schedules.`:"We built a $29 caption generator that fits real-world schedules.",k=["3 platform-ready captions per run—no blank-page panic.","Platform & format aware, so you post faster.","First-comment hashtags ready when you need them."],w=[n||"More qualified inquiries—without the 90-minute caption spiral.","Stay visible, stay booked.","Less time typing, more time serving clients."],b=s?[s]:["Book now","Call today","Message us to claim","Learn more","See how it works","Get your free consult"],v=pick([`${f}, this is for you.`,`Quick win: ${n||"better results, less stress"}.`,`Still wrestling with ${a||"content taking too long"}?`,`${f}—you don’t need another app; you need momentum.`,`Tiny change, big ripple: ${n||"more qualified leads"}.`]),C=pick(y),q=pick(k),S=pick(w),L=pick(b),$=String(c||"medium").toLowerCase();let T="short"===$?[v,h,L]:"long"===$?[v,C,h,q,S,L]:[v,C,h,q,S,L];const x=Number(l)||.5;x>.6?T=T.filter(Boolean).slice(0,4):x<.4&&T.length>5&&(T=T.filter(Boolean).slice(0,5));let M=T.filter(Boolean).join(p.lineBreaks?"\n\n":" ");const B=buildHashtags(m,(qs("#hashtagDensity")?.value||"Standard").toLowerCase(),!!qs("#cleanHashtags")?.checked,i,u);return B&&(M=p.lineBreaks?`${M}\n\n${B}`:`${M} ${B}`),M=humanize(M,{platform:i,playful:x>.6,pro:x<.4}),M}const WORKER_URLS=["https://www.bluedobiedev.com/api/remix","https://dobiecore-remix.melanie-brown.workers.dev"];async function maybeRemixWithAI(e,t){if(!isPro())return e;const o={drafts:e.map(((e,t)=>({id:String(t+1),text:e}))),platform:t.platform||"instagram",tone:"number"==typeof t.tone?t.tone:.5,length:(t.length||"medium").toLowerCase(),ctaOptions:function(e){const t=["Book now","Call today","Message us to claim","Learn more","See how it works","Get your free consult"],o=[];for(e&&e.trim()&&o.push(e.trim());o.length<3;){const e=pick(t);o.includes(e)||o.push(e)}return Array.from(new Set(o)).slice(0,3)}(t.cta),hashtags:buildHashtags(t.keywords,(t.hashtagDensity||"standard").toLowerCase(),!1!==t.cleanHashtags,t.platform,t.format)};for(const e of WORKER_URLS)try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok)continue;const a=await t.json();if(Array.isArray(a)&&a.length)return a.map((e=>String(e.text||""))).filter(Boolean)}catch{}return console.warn("AI remix unavailable; using local drafts"),e}function renderCards(e){const t=qs("#results");t.innerHTML="",e.forEach(((e,o)=>{const a=document.createElement("article");a.className="card";const n=e.split("\n").filter((e=>e.trim().startsWith("#"))).join(" "),r=n?`<div class="first-comment"><div class="muted">First comment</div><textarea readonly>${n}</textarea><div class="actions"><button type="button" class="copy-first-btn">Copy first comment</button></div></div>`:"";a.innerHTML=`\n      <h3 style="margin:0 0 6px;">Caption ${o+1}</h3>\n      <textarea readonly>${e}</textarea>\n      <div class="row" style="gap:8px;flex-wrap:wrap;margin-top:8px;">\n        <button type="button" class="copy-btn">Copy</button>\n        <span class="meta">Platform-ready</span>\n      </div>\n      ${r}\n    `,t.appendChild(a);const s=a.querySelector(".copy-btn"),i=a.querySelector("textarea");s?.addEventListener("click",(()=>{i.select(),document.execCommand("copy"),s.textContent="Copied!",setTimeout((()=>s.textContent="Copy"),1200)}));const l=a.querySelector(".copy-first-btn");if(l){const e=a.querySelector(".first-comment textarea");l.addEventListener("click",(()=>{e.select(),document.execCommand("copy"),l.textContent="Copied!",setTimeout((()=>l.textContent="Copy first comment"),1200)}))}}))}function readBrief(){return{company:qs("#company")?.value||"",audience:qs("#audience")?.value||"",offer:qs("#offer")?.value||"",problem:qs("#problem")?.value||"",outcome:qs("#outcome")?.value||"",cta:qs("#cta")?.value||"",keywords:qs("#keywords")?.value||"",platform:qs("#platform")?.value||"Instagram",format:qs("#format")?.value||"Post",length:qs("#captionLength")?.value||"Medium",tone:parseFloat(qs("#tone")?.value||"0.5"),hashtagDensity:qs("#hashtagDensity")?.value||"Standard",cleanHashtags:!!qs("#cleanHashtags")?.checked,voiceMode:qs("#voiceMode")?.value||"leadgen"}}window.addEventListener("DOMContentLoaded",(()=>{updateUsageCounter();const e=qs("#captionForm"),t=qs("#results"),o=qs("#clearBtn");qs("#upgradeBtn")?.addEventListener("click",(()=>{window.location.href="https://buy.stripe.com/6oUaEY6oTaHBcd6drP0x203"})),qs("#alreadyProBtn")?.addEventListener("click",(()=>{const e=prompt("Enter the email you used to upgrade (temporary local unlock):");e&&/\S+@\S+\.\S+/.test(e)?(localStorage.setItem("dcc_pro_email",e),localStorage.setItem("dcc_pro","1"),closeModal(),updateUsageCounter(),alert("Pro unlocked on this browser.")):alert("That email doesn’t look valid.")})),qs("#closeModalBtn")?.addEventListener("click",closeModal),window.addEventListener("click",(e=>{const t=qs("#upgradeModal");e.target===t&&closeModal()})),e?.addEventListener("submit",(async e=>{if(e.preventDefault(),!isPro()){const{n:e}=getUsage();if(e>=3)return void showUpgrade()}const o=readBrief();if(!o.offer.trim())return void alert("Please enter your Offer.");t.innerHTML="";const a=platformKey(o.platform,o.format),n=TPL[a]||makeTemplate,r=[];for(let e=0;e<3;e++)r.push(n(o));renderCards(await maybeRemixWithAI(r,o)),isPro()||(incrementUsage(),updateUsageCounter())})),o?.addEventListener("click",(()=>{e.reset(),t.innerHTML="",updateUsageCounter()}))}));