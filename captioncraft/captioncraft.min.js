// @ts-nocheck
const qs=(e,t=document)=>t.querySelector(e),qsa=(e,t=document)=>Array.from(t.querySelectorAll(e));function todayKey(){const e=new Date;return`dcc_usage_${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}function getUsage(){const e=todayKey();return{key:e,n:parseInt(localStorage.getItem(e)||"0",10)}}function incrementUsage(){const{key:e,n:t}=getUsage();localStorage.setItem(e,String(t+1))}function resetIfNewDay(){}function isPro(){return"1"===localStorage.getItem("dcc_pro")||!!localStorage.getItem("dcc_pro_email")}function updateUsageCounter(){const e=qs("#usageCounter");if(!e)return;if(isPro())return void(e.textContent="Pro: unlimited captions");const{n:t}=getUsage();e.textContent=`Free today: ${Math.max(0,3-t)} of 3 left`}function showUpgrade(){qs("#upgradeModal").style.display="block"}function closeModal(){qs("#upgradeModal").style.display="none"}function platformKey(e="Instagram",t="Post"){return`${String(e||"").toLowerCase()}:${String(t||"").toLowerCase()}`}function platformStyle(e){switch((e||"").toLowerCase()){case"linkedin":return{emoji:!1,lineBreaks:!0,hashCap:6};case"tiktok":return{emoji:!0,lineBreaks:!1,hashCap:8};case"facebook":return{emoji:!0,lineBreaks:!0,hashCap:8};case"twitter":return{emoji:!1,lineBreaks:!0,hashCap:4};default:return{emoji:!0,lineBreaks:!0,hashCap:12}}}function cleanPunctuation(e=""){return e.replace(/\s{2,}/g," ").replace(/([.!?])\1{1,}/g,"$1").replace(/([.!?])\s*([.!?])/g,"$1 ").replace(/\s+([,.;:!?])/g,"$1").replace(/([,.;:!?])([^\s])/g,"$1 $2").replace(/\s{2,}/g," ").trim()}const COMMON_VERBS=/(?:get|have|be|is|are|was|were|do|make|build|grow|find|fix|help|win|drive|boost|book|buy|claim|start|learn|see|save|earn|bring|keep|write|post|plan|schedule|recap)/i;function isHashtagLine(e){return/^#\w/.test(e.trim())}function isUrl(e){return/^https?:\/\//i.test(e)}function isTitleLine(e){return/^caption\s+\d+/i.test(e.trim())}function cleanLine(e){if(isHashtagLine(e)||isUrl(e)||isTitleLine(e))return e.trim();let t=e.replace(/\s{2,}/g," ").replace(/\.{4,}/g,"…").trim();t=t.replace(/\b(\w+)\s+\1\b/gi,"$1"),t.length>0&&(t=t[0].toUpperCase()+t.slice(1));t.length<25&&/[!?]$/.test(t),COMMON_VERBS.test(t);return t}function cleanTag(e){return e.toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g,"").replace(/^#+/,"")}function buildHashtags(e="",t="standard",a=!0,o="instagram",n="post"){const r=String(o||"").toLowerCase(),s=String(n||"").toLowerCase();if("gmb"===r||"youtube"===r||"story"===s)return"";let i=String(e||"").split(",").map((e=>e.trim())).filter(Boolean);a&&(i=i.map(cleanTag)),i=[...new Set(i)].filter(Boolean);let l=5;return"instagram"===r||"facebook"===r?l="reel"===s?7:"heavy"===t?10:"light"===t?4:7:"twitter"===r?l="heavy"===t?3:2:"linkedin"===r?l="heavy"===t?5:"light"===t?2:3:"tiktok"===r?l="heavy"===t?15:"light"===t?6:10:"ytshorts"===r&&(l="heavy"===t?7:"light"===t?3:5),i.slice(0,l).map((e=>e?`#${e}`:"")).filter(Boolean).join(" ")}function brandLead(e){const t=(e||"").trim();return t?Math.random()<.5?`At ${t}, `:`${t} — `:""}const TPL={"facebook:post":makeTemplate,"facebook:story":makeTemplate,"facebook:reel":makeTemplate,"instagram:post":makeTemplate,"instagram:story":makeTemplate,"instagram:reel":makeTemplate,"twitter:post":makeTemplate,"linkedin:post":makeTemplate,"gmb:post":makeTemplate,"tiktok:video":makeTemplate,"ytshorts:short":makeTemplate};function makeTemplate(e){const{company:t,audience:a,problem:o,outcome:n,offer:r,cta:s,platform:i,tone:l,length:c,keywords:u,format:d,voiceMode:m}=e,p=platformStyle(i),g=`${brandLead(t)}we get it—small business owners need more inquiries.`,f=[`Quick win: ${n||"better results, less stress"}.`,`Tired of ${o||"content taking too long"}?`,`${(a||"Busy owners")[0].toUpperCase()+(a||"Busy owners").slice(1)}, this is for you.`];let h=f[Math.floor(Math.random()*f.length)];const y=[r?`We built ${r} for real‑world schedules.`:"We built a tool for real‑world schedules.","Get captions done fast so you can stay visible.",n?`Bottom line: ${n}.`:"",s?`${s}`:""].filter(Boolean);let k=3;const w=String(c||"medium").toLowerCase();"short"===w&&(k=2),"medium"===w&&(k=3),"long"===w&&(k=Math.min(y.length,5));const b=[];let v=y.slice();for(;b.length<k&&v.length;)b.push(v.splice(Math.floor(Math.random()*v.length),1)[0]);let C=[h,g,b.join(p.lineBreaks?"\n":" ")].filter(Boolean).join(p.lineBreaks?"\n\n":" ");const L=buildHashtags(u,qs("#hashtagDensity")?.value?.toLowerCase()||"standard",!!qs("#cleanHashtags")?.checked,i,d);return L&&(C=p.lineBreaks?`${C}\n\n${L}`:`${C} ${L}`),C=cleanPunctuation(C),C}const CTA_POOL=["Book now","Call today","Message us to claim","Learn more","See how it works","Get your free consult"];function pickCTAs(e){const t=[];for(e&&e.trim()&&t.push(e.trim());t.length<3;){const e=CTA_POOL[Math.floor(Math.random()*CTA_POOL.length)];t.includes(e)||t.push(e)}return Array.from(new Set(t)).slice(0,3)}const WORKER_URLS=["https://www.bluedobiedev.com/api/remix","https://dobiecore-remix.melanie-brown.workers.dev"];async function maybeRemixWithAI(e,t){if(!isPro())return e;const a={drafts:e.map(((e,t)=>({id:String(t+1),text:e}))),platform:t.platform||"instagram",tone:"number"==typeof t.tone?t.tone:.5,length:(t.length||"medium").toLowerCase(),ctaOptions:pickCTAs(t.cta),hashtags:buildHashtags(t.keywords,(t.hashtagDensity||"standard").toLowerCase(),!1!==t.cleanHashtags,t.platform,t.format)};for(const e of WORKER_URLS)try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)continue;const o=await t.json();if(Array.isArray(o)&&o.length)return o.map((e=>String(e.text||""))).filter(Boolean)}catch{}return console.warn("AI remix unavailable; using local drafts"),e}function renderCards(e){const t=qs("#results");t.innerHTML="",e.forEach(((e,a)=>{const o=document.createElement("article");o.className="caption-card";const n=e.split("\n").filter((e=>e.trim().startsWith("#"))).join(" "),r=n?`<div class="first-comment"><div class="muted">First comment</div><textarea readonly>${n}</textarea><div class="actions"><button type="button" class="copy-first-btn">Copy first comment</button></div></div>`:"";o.innerHTML=`\n      <h3>Caption ${a+1}</h3>\n      <textarea readonly>${e}</textarea>\n      <div class="row" style="gap:8px;flex-wrap:wrap;">\n        <button type="button" class="copy-btn">Copy</button>\n        <span class="meta">Platform-ready</span>\n      </div>\n      ${r}\n    `,t.appendChild(o);const s=o.querySelector(".copy-btn"),i=o.querySelector("textarea");s?.addEventListener("click",(()=>{i.select(),document.execCommand("copy"),s.textContent="Copied!",setTimeout((()=>s.textContent="Copy"),1200)}));const l=o.querySelector(".copy-first-btn");if(l){const e=o.querySelector(".first-comment textarea");l.addEventListener("click",(()=>{e.select(),document.execCommand("copy"),l.textContent="Copied!",setTimeout((()=>l.textContent="Copy first comment"),1200)}))}}))}function readBrief(){return{company:qs("#company")?.value||"",audience:qs("#audience")?.value||"",offer:qs("#offer")?.value||"",problem:qs("#problem")?.value||"",outcome:qs("#outcome")?.value||"",cta:qs("#cta")?.value||"",keywords:qs("#keywords")?.value||"",platform:qs("#platform")?.value||"Instagram",format:qs("#format")?.value||"Post",length:qs("#captionLength")?.value||"Medium",tone:parseFloat(qs("#tone")?.value||"0.5"),hashtagDensity:qs("#hashtagDensity")?.value||"Standard",cleanHashtags:!!qs("#cleanHashtags")?.checked,voiceMode:qs("#voiceMode")?.value||"leadgen"}}window.addEventListener("DOMContentLoaded",(()=>{resetIfNewDay(),updateUsageCounter();const e=qs("#captionForm"),t=qs("#results"),a=qs("#clearBtn");qs("#upgradeBtn")?.addEventListener("click",(()=>{window.location.href="https://buy.stripe.com/6oUaEY6oTaHBcd6drP0x203"})),qs("#alreadyProBtn")?.addEventListener("click",(()=>{const e=prompt("Enter the email you used to upgrade (temporary local unlock):");e&&/\S+@\S+\.\S+/.test(e)?(localStorage.setItem("dcc_pro_email",e),localStorage.setItem("dcc_pro","1"),closeModal(),updateUsageCounter(),alert("Pro unlocked on this browser.")):alert("That email doesn’t look valid.")})),qs("#closeModalBtn")?.addEventListener("click",closeModal),window.addEventListener("click",(e=>{const t=qs("#upgradeModal");e.target===t&&closeModal()})),e?.addEventListener("submit",(async e=>{if(e.preventDefault(),!isPro()){const{n:e}=getUsage();if(e>=3)return void showUpgrade()}const t=readBrief();if(!t.offer.trim())return void alert("Please enter your Offer.");const a=platformKey(t.platform,t.format),o=TPL[a]||makeTemplate,n=[];for(let e=0;e<3;e++)n.push(o(t));renderCards(await maybeRemixWithAI(n,t)),isPro()||(incrementUsage(),updateUsageCounter())})),a?.addEventListener("click",(()=>{qs("#captionForm").reset(),t.innerHTML="",updateUsageCounter()}))}));